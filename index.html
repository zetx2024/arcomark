<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="path_to_placeholder_image.jpg"> <!-- This will be updated dynamically -->
    <meta property="og:image" content="path_to_placeholder_image.jpg"> <!-- This will be updated dynamically -->
    <meta name="twitter:description" content="Check out the top students of IARCO 2024.">
    <meta property="og:description" content="Check out the top students of IARCO 2024.">
    <meta name="twitter:title" content="Student Rank Details">
    <meta property="og:title" content="Student Rank Details">
    <title>Student Details with Rank Sharing</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f9f9f9;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        table, th, td {
            border: 1px solid #ddd;
        }

        th, td {
            padding: 10px;
            text-align: center;
            cursor: pointer;
        }

        th {
            background-color: #f4f4f4;
        }

        .share-button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            margin-top: 10px;
        }

        .share-button:hover {
            background-color: #45a049;
        }

        .share-container {
            margin-top: 20px;
        }

        .toggle-buttons {
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .toggle-buttons button {
            padding: 10px 20px;
            background-color: #ddd;
            color: #333;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .toggle-buttons button:hover {
            background-color: #aaa;
        }

        .toggle-buttons button.active {
            background-color: #4CAF50;
            color: white;
        }

        .gold {
            background-color: gold;
            color: black;
        }

        .silver {
            background-color: silver;
            color: black;
        }

        .bronze {
            background-color: #cd7f32;
            color: black;
        }
    </style>
</head>
<body>

<h2>Student Details Table</h2>

<div class="toggle-buttons">
    <button id="juniorButton" class="active">Junior</button>
    <button id="seniorButton">Senior</button>
</div>

<table id="studentTable">
    <thead>
        <tr>
            <th>Rank</th>
            <th>Name</th>
            <th>Category</th>
            <th>Roll Number</th>
            <th>Score</th>
        </tr>
    </thead>
    <tbody>
        <!-- Rows will be populated via JavaScript -->
    </tbody>
</table>

<div class="share-container">
    <button class="share-button" id="shareButton">Share Rank</button>
</div>

<script>
// Sample JSON data with category and scores (no rank field)
const studentsData = [
    { "name": "John Doe", "category": "Senior", "rollNumber": "S101", "scaledFinalScore": 98 },
    { "name": "Jane Smith", "category": "Senior", "rollNumber": "S102", "scaledFinalScore": 96 },
    { "name": "Alice Brown", "category": "Senior", "rollNumber": "S103", "scaledFinalScore": 94 },
    { "name": "Bob White", "category": "Senior", "rollNumber": "S104", "scaledFinalScore": 92 },
    { "name": "David Black", "category": "Junior", "rollNumber": "J101", "scaledFinalScore": 89 },
    { "name": "Emma Blue", "category": "Junior", "rollNumber": "J102", "scaledFinalScore": 87 },
    { "name": "Grace Green", "category": "Junior", "rollNumber": "J103", "scaledFinalScore": 85 },
    { "name": "Tom Red", "category": "Junior", "rollNumber": "J104", "scaledFinalScore": 82 }
];

// Function to calculate and sort students by their scaledFinalScore to determine rank
function calculateRanks(students) {
    // Sort students by scaledFinalScore in descending order
    students.sort((a, b) => b.scaledFinalScore - a.scaledFinalScore);

    // Assign ranks based on sorted order
    students.forEach((student, index) => {
        student.rank = index + 1;  // Ranks start from 1
    });

    return students;
}

// Function to generate table rows from sorted and ranked student data
function generateTable(category) {
    const tableBody = document.querySelector('#studentTable tbody');
    const filteredStudents = studentsData.filter(student => student.category === category);
    const rankedStudents = calculateRanks(filteredStudents);

    tableBody.innerHTML = '';  // Clear previous rows

    rankedStudents.forEach(student => {
        const row = document.createElement('tr');
        row.dataset.rank = student.rank;
        row.dataset.category = student.category;

        // Apply Gold, Silver, Bronze coloring to the top 3 ranks
        if (student.rank === 1) row.classList.add('gold');
        if (student.rank === 2) row.classList.add('silver');
        if (student.rank === 3) row.classList.add('bronze');

        row.innerHTML = `
            <td>${student.rank}</td>
            <td>${student.name}</td>
            <td>${student.category}</td>
            <td>${student.rollNumber}</td>
            <td>${student.scaledFinalScore}</td>
        `;

        // Add event listener for double-clicking any table element to copy rank link
        row.querySelectorAll('td').forEach(cell => {
            cell.addEventListener('dblclick', () => copyRankLink(student.category, student.rank));
        });

        tableBody.appendChild(row);
    });

    // Check if the URL contains a rank query parameter after the table is generated
    const urlParams = new URLSearchParams(window.location.search);
    const rankFromUrl = urlParams.get('rank');
    const categoryFromUrl = urlParams.get('category');
    if (rankFromUrl && categoryFromUrl === category) {
        highlightRank(rankFromUrl);
        updateMetaTags(categoryFromUrl, rankFromUrl);  // Update meta tags when a rank is passed
    }
}

// Function to highlight the rank when a link is clicked
function highlightRank(rank) {
    const allRows = document.querySelectorAll('#studentTable tbody tr');
    allRows.forEach(row => {
        row.style.backgroundColor = '';  // Remove previous highlighting
    });

    const rowToHighlight = document.querySelector(`#studentTable tbody tr[data-rank="${rank}"]`);
    if (rowToHighlight) {
        rowToHighlight.style.backgroundColor = 'red';
        rowToHighlight.style.color = 'white'; // Text color white for better contrast
    }
}

// Function to copy the rank link to clipboard when a table cell is double-clicked
function copyRankLink(category, rank) {
    const rankLink = `${window.location.href.split('?')[0]}?category=${category}&rank=${rank}`;
    
    const tempInput = document.createElement('input');
    tempInput.value = rankLink;
    document.body.appendChild(tempInput);
    tempInput.select();
    document.execCommand('copy');
    document.body.removeChild(tempInput);

    alert(`Rank link copied to clipboard: ${rankLink}`);
}

// Function to update meta tags dynamically based on rank and student details
function updateMetaTags(category, rank) {
    const student = studentsData.find(s => s.category === category && s.rank === parseInt(rank));
    if (!student) return;

    const title = `${student.name} is ${student.rank}th in ${category} to IARCO 2024`;
    const description = `${student.name} secured rank ${student.rank} with a score of ${student.scaledFinalScore} in IARCO 2024 (Category: ${category}).`;

    // Update meta tags dynamically
    document.title = title;

    // Update Open Graph meta tags
    document.querySelector('meta[property="og:title"]').setAttribute('content', title);
    document.querySelector('meta[property="og:description"]').setAttribute('content', description);

    // Update Twitter meta tags
    document.querySelector('meta[name="twitter:title"]').setAttribute('content', title);
    document.querySelector('meta[name="twitter:description"]').setAttribute('content', description);
}

// Event listener for the "Share Rank" button
document.getElementById('shareButton').addEventListener('click', () => {
    const category = document.querySelector('button.active').textContent.toLowerCase();
    const student = studentsData.find(s => s.category === category);
    const studentRank = student ? student.rank : 1;

    const rankLink = `${window.location.href.split('?')[0]}?category=${category}&rank=${studentRank}`;
    alert(`Share this link to share the student's rank: ${rankLink}`);
    
    console.log(`Share this link: ${rankLink}`);
});

// Toggle button functionality for Junior and Senior categories
document.getElementById('juniorButton').addEventListener('click', () => {
    document.getElementById('juniorButton').classList.add('active');
    document.getElementById('seniorButton').classList.remove('active');
    generateTable('Junior');
});

document.getElementById('seniorButton').addEventListener('click', () => {
    document.getElementById('seniorButton').classList.add('active');
    document.getElementById('juniorButton').classList.remove('active');
    generateTable('Senior');
});

// Handle URL query to select category and highlight the rank if provided
const urlParams = new URLSearchParams(window.location.search);
const categoryFromUrl = urlParams.get('category');
const rankFromUrl = urlParams.get('rank');

// Default to Junior category if no category is specified in the URL
if (categoryFromUrl && (categoryFromUrl === 'junior' || categoryFromUrl === 'senior')) {
    document.getElementById(`${categoryFromUrl}Button`).classList.add('active');
    generateTable(categoryFromUrl.charAt(0).toUpperCase() + categoryFromUrl.slice(1));
} else {
    // Default to Junior if no category in URL
    document.getElementById('juniorButton').classList.add('active');
    generateTable('Junior');
}
</script>

</body>
</html>
